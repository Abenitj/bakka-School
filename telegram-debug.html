<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Debug Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 5px;
            border-left: 4px solid #2196f3;
        }
        .success {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }
        .error {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #f44336;
        }
        .warning {
            background: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #ff9800;
        }
        button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        .code {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Telegram Debug Tool</h1>
        <p>Let's figure out why you're not receiving messages in Telegram.</p>
        
        <div class="step">
            <h3>Step 1: Test Bot Token</h3>
            <button onclick="testBotToken()">Test Bot Token</button>
            <div id="botResult"></div>
        </div>

        <div class="step">
            <h3>Step 2: Test Chat ID</h3>
            <button onclick="testChatId()">Test Chat ID</button>
            <div id="chatResult"></div>
        </div>

        <div class="step">
            <h3>Step 3: Send Test Message</h3>
            <button onclick="sendTestMessage()">Send Test Message</button>
            <div id="messageResult"></div>
        </div>

        <div class="step">
            <h3>Step 4: Check Recent Messages</h3>
            <button onclick="checkRecentMessages()">Check Recent Messages</button>
            <div id="recentResult"></div>
        </div>

        <div class="step">
            <h3>Step 5: Manual URL Test</h3>
            <p>Try this URL directly in your browser:</p>
            <div class="code" id="manualUrl"></div>
            <button onclick="openManualUrl()">Open Manual URL</button>
        </div>

        <div class="step">
            <h3>Step 6: Check Bot Status</h3>
            <button onclick="checkBotStatus()">Check Bot Status</button>
            <div id="statusResult"></div>
        </div>
    </div>

    <script>
        const BOT_TOKEN = '8380849170:AAGJIxZ3a4iY9tYv9hMzkHMXDSNk-4yLEdE';
        const CHAT_ID = '5971113567';
        
        // Update manual URL
        document.getElementById('manualUrl').textContent = 
            `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=Manual%20Test%20Message`;
        
        async function testBotToken() {
            const resultDiv = document.getElementById('botResult');
            resultDiv.innerHTML = '<p>Testing bot token...</p>';
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getMe`);
                const data = await response.json();
                
                if (data.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>‚úÖ Bot Token is Valid!</strong><br>
                            Bot Name: ${data.result.first_name}<br>
                            Bot Username: @${data.result.username}<br>
                            Bot ID: ${data.result.id}<br>
                            Can Join Groups: ${data.result.can_join_groups}<br>
                            Can Read All Group Messages: ${data.result.can_read_all_group_messages}<br>
                            Supports Inline Queries: ${data.result.supports_inline_queries}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ùå Bot Token Error:</strong><br>
                            ${data.description}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Network Error:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        async function testChatId() {
            const resultDiv = document.getElementById('chatResult');
            resultDiv.innerHTML = '<p>Testing chat ID...</p>';
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getChat?chat_id=${CHAT_ID}`);
                const data = await response.json();
                
                if (data.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>‚úÖ Chat ID is Valid!</strong><br>
                            Chat Type: ${data.result.type}<br>
                            Chat Title: ${data.result.title || data.result.first_name || 'Private Chat'}<br>
                            Chat ID: ${data.result.id}<br>
                            Username: @${data.result.username || 'No username'}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ùå Chat ID Error:</strong><br>
                            ${data.description}<br>
                            <strong>Possible issues:</strong><br>
                            ‚Ä¢ You haven't started a conversation with the bot<br>
                            ‚Ä¢ The bot is blocked<br>
                            ‚Ä¢ Wrong chat ID
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Network Error:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        async function sendTestMessage() {
            const resultDiv = document.getElementById('messageResult');
            resultDiv.innerHTML = '<p>Sending test message...</p>';
            
            const testMessage = `üß™ DEBUG TEST MESSAGE
            
‚úÖ Bot Integration Test
üìÖ Time: ${new Date().toLocaleString()}
üè´ From: Bakka Secondary School Debug Tool

This is a debug test message to verify the integration is working.`;
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: testMessage,
                        parse_mode: 'Markdown'
                    })
                });
                
                const data = await response.json();
                
                if (data.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>‚úÖ Test Message Sent Successfully!</strong><br>
                            Message ID: ${data.result.message_id}<br>
                            Date: ${new Date(data.result.date * 1000).toLocaleString()}<br>
                            Chat: ${data.result.chat.title || data.result.chat.first_name}<br>
                            <strong>Check your Telegram now!</strong>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ùå Send Error:</strong><br>
                            ${data.description}<br>
                            <strong>Error Code:</strong> ${data.error_code}<br>
                            <strong>Parameters:</strong> ${JSON.stringify(data.parameters || {})}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Network Error:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        async function checkRecentMessages() {
            const resultDiv = document.getElementById('recentResult');
            resultDiv.innerHTML = '<p>Checking recent messages...</p>';
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getUpdates`);
                const data = await response.json();
                
                if (data.ok) {
                    const updates = data.result;
                    if (updates.length > 0) {
                        resultDiv.innerHTML = `
                            <div class="success">
                                <strong>‚úÖ Found ${updates.length} recent updates!</strong><br>
                                <strong>Recent messages:</strong><br>
                                ${updates.slice(-5).map(update => 
                                    `‚Ä¢ ${new Date(update.message.date * 1000).toLocaleString()}: ${update.message.text || 'No text'}`
                                ).join('<br>')}
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `
                            <div class="warning">
                                <strong>‚ö†Ô∏è No recent messages found</strong><br>
                                This could mean:<br>
                                ‚Ä¢ You haven't sent any messages to the bot<br>
                                ‚Ä¢ The bot is not receiving updates<br>
                                ‚Ä¢ The bot is blocked
                            </div>
                        `;
                    }
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ùå Error getting updates:</strong><br>
                            ${data.description}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Network Error:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        function openManualUrl() {
            const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=Manual%20Test%20Message`;
            window.open(url, '_blank');
        }
        
        async function checkBotStatus() {
            const resultDiv = document.getElementById('statusResult');
            resultDiv.innerHTML = '<p>Checking bot status...</p>';
            
            try {
                // Check bot info
                const botResponse = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getMe`);
                const botData = await botResponse.json();
                
                // Check webhook info
                const webhookResponse = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getWebhookInfo`);
                const webhookData = await webhookResponse.json();
                
                if (botData.ok && webhookData.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>‚úÖ Bot Status Check Complete!</strong><br>
                            <strong>Bot Info:</strong><br>
                            ‚Ä¢ Name: ${botData.result.first_name}<br>
                            ‚Ä¢ Username: @${botData.result.username}<br>
                            ‚Ä¢ ID: ${botData.result.id}<br>
                            ‚Ä¢ Can Join Groups: ${botData.result.can_join_groups}<br>
                            <strong>Webhook Info:</strong><br>
                            ‚Ä¢ URL: ${webhookData.result.url || 'Not set'}<br>
                            ‚Ä¢ Pending Updates: ${webhookData.result.pending_update_count}<br>
                            ‚Ä¢ Last Error: ${webhookData.result.last_error_message || 'None'}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ùå Status Check Failed:</strong><br>
                            Bot: ${botData.description || 'OK'}<br>
                            Webhook: ${webhookData.description || 'OK'}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Network Error:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }
        
        // Auto-run tests on page load
        window.addEventListener('load', function() {
            console.log('Running automatic tests...');
            testBotToken();
        });
    </script>
</body>
</html>


